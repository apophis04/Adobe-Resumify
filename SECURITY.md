# Security Guidelines

## Iframe Sandboxing Issue

### Warning
An iframe with **both** `allow-scripts` and `allow-same-origin` attributes can potentially escape its sandbox restrictions. This is a known security vulnerability.

### Current Status
This add-on runs within Adobe Express's iframe container. Adobe handles the iframe sandboxing at the platform level. The warnings you see are generated by Adobe's system to notify developers about the security implications.

### What We Control
Our application cannot directly modify Adobe's iframe sandbox configuration. However, we've implemented additional security measures on the backend:

#### Server-Side Security Headers (server.js)

1. **X-Frame-Options: SAMEORIGIN**
   - Prevents our content from being framed by unauthorized sites
   - Allows Adobe's legitimate framing

2. **X-Content-Type-Options: nosniff**
   - Prevents browser from MIME-sniffing
   - Protects against content-type attacks

3. **X-XSS-Protection: 1; mode=block**
   - Enables XSS filter in browsers
   - Blocks page if XSS is detected

4. **Referrer-Policy: strict-origin-when-cross-origin**
   - Controls what referrer information is shared
   - Prevents leaking of sensitive URLs

5. **Content-Security-Policy**
   - Restricts which domains can provide scripts, styles, images
   - Prevents unauthorized script injection
   - Allows trusted sources only (OpenAI API for legitimate requests)

## Best Practices Implemented

### Frontend Security
- ✅ No inline JavaScript execution in HTML
- ✅ All scripts loaded from trusted sources
- ✅ React prevents XSS through automatic escaping
- ✅ No sensitive data in localStorage/sessionStorage

### Backend Security
- ✅ Input validation on all POST endpoints
- ✅ Proper error handling without exposing stack traces
- ✅ CORS configured appropriately
- ✅ No secrets stored in repository (.env gitignored)
- ✅ API rate limiting ready (use express-rate-limit for production)

### Data Handling
- ✅ Resume PDFs processed in memory only
- ✅ No persistent storage of user files
- ✅ HTTPS required for production deployment
- ✅ All API calls use HTTPS

## Recommendations for Production

1. **Environment Variables**
   - Keep `OPENAI_API_KEY` in `.env.local` (never commit)
   - Use different keys for dev/staging/production

2. **Rate Limiting**
   ```javascript
   const rateLimit = require("express-rate-limit");
   const limiter = rateLimit({
       windowMs: 15 * 60 * 1000, // 15 minutes
       max: 100 // limit each IP to 100 requests per windowMs
   });
   app.use("/api/", limiter);
   ```

3. **Input Validation**
   - Validate all file uploads (check MIME types, size limits)
   - Sanitize text inputs before processing
   - Reject oversized payloads

4. **HTTPS & TLS**
   - Always use HTTPS in production
   - Enforce HSTS (HTTP Strict-Transport-Security)

5. **Monitoring**
   - Log security events
   - Monitor for suspicious API patterns
   - Set up alerts for repeated failures

## Adobe Express Sandbox Limitations

The following features are restricted due to Adobe's iframe sandbox:
- ❌ Clipboard API (blocked by permissions policy)
- ❌ Pop-ups / `window.open()` (requires `allow-popups`)
- ❌ File downloads (requires `allow-downloads`)
- ❌ Full filesystem access

These are intentional security measures by Adobe to protect user data.

## References
- [MDN: iframe sandbox attribute](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe#sandbox)
- [OWASP: Content Security Policy](https://owasp.org/www-community/attacks/xss/)
- [Adobe Express Security](https://developer.adobe.com/express/add-ons/docs/guides/develop/security)
